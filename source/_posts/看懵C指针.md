---
title: 看懵C指针
date: 2022-04-25 11:39:25
tags:
---

[只需一招，彻底攻克C语言指针，再复杂的指针都不怕](http://c.biancheng.net/view/vip_2024.html)

```text
C语言标准规定，对于一个符号的定义，编译器总是从它的名字开始读取，然后按照优先级顺序依次解析。
对，从名字开始，不是从开头也不是从末尾，这是理解复杂指针的关键！

对于初学者，有几种运算符的优先级非常容易混淆，它们的优先级从高到低依次是：
定义中被括号( )括起来的那部分。
后缀操作符：括号( )表示这是一个函数，方括号[ ]表示这是一个数组。
前缀操作符：星号*表示“指向xxx的指针”。
```

```C
int a = 10, *pa = &a, *paa = &a;
```

变量在等号左边时，是设置变量的值（set）。   
变量在等号右边时，是获取变量的值（get）。

定义变量和赋值是两件事，只是有时可以同时做了。
```text
int a;
a = 1;

int b = 2;
```

指针其实是 能"保存变量" 的变量，类似于"元变量"/"高阶变量"。  
指针只有一种类型，是特殊的整数类型。  

定义 一级指针 时，*号其实是和变量类型一伙的。
```text
int a;    // int 是解释 变量a 的类型
int* b;   // int 是解释 * 的类型， 变量b是一种特殊的整数类型
void *ptr; // 存放任何数据类型的引用
b = &a;
```
我们平时误以为 *和变量名一伙的原因是
C语言把 
```text
int a, int* b 
```
简写成
```text
int a, *b
```
误以为有个变量叫 *b，其实只有变量b， 这么简写就是在捣乱。      
变量a、b类型不同就别简写到一块啊！！！

定义二级/多级指针时，更高级的*不用再加类型解释,因为都是特殊整数
```text
int a =100;
int* p1 = &a;

int** p2 = &p1;

int** p3;
// 等同于（伪代码）
p3 => * => * => int;
```

数组是特殊的一级指针，没有*号，它比普通指针多了"后面兄弟人数"的信息。
```text
int arr[6]    // arr => [6] => int

int* pArr[6]; // pArr => [6] => * => int
```
```text
int arr[6];      
int* p;     
p = arr;         // 赋值时也省略了&

int (* p1)[6];   // 二级指针数组
// * p1 => [6] => int
// p1 => * => [6] => int
// p1是一个指针，指针指向一个数组,该数组的元素类型是int
```

函数指针也是特殊的一级指针，它有*号，但不加类型解释,类型放到后面解释参数类型了。
```text
int max(int x, int y){ return x > y ? x : y;}

int (* pfunc)(int, int);  // pfunc => (*)(int,int) => int
pfunc = max;              // 赋值时省略了&
(*pmax)(x, y)             // 调用时也要加括号 
```

分析1：
```text
char* (* c[10]) (int**);
(* c[10]) (int**) => char*
(* c[10]) (int**) => * => char
(* c[10]) (int**) => * => char
c[10] => (*) (int**) => * => char
c => [10] => (*) (int**) => * => char
// c 是一个数组，元素是函数指针，返回值是指针，指针类型是char
```
分析2：
```text
int (*(*(*pfunc)(int *))[5])(int *);
(*(*(*pfunc)(int *))[5])(int *) => int
(*(*pfunc)(int *))[5] => (*)(int *) => int
*(*pfunc)(int *) => [5] => (*)(int *) => int
(*pfunc)(int *) => * => [5] => (*)(int *) => int
pfunc => (*)(int *) => * => [5] => (*)(int *) => int
// pfunc 是一个函数指针，返回值也是指针，指针指向一个数组，数组元素是函数指针，返回值是int
```
在表达式中，*代表高阶变量降阶，&代码变量升阶。